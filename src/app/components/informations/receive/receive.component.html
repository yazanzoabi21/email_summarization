<div class="container">
    <div *ngIf="isLoading" class="alert alert-info text-center mt-3">Loading emails...</div>
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

    <div *ngIf="!isLoading && emails.length === 0" class="alert alert-warning text-center">
        No received emails found.
    </div>

    <div *ngIf="!isLoading" class="table-responsive">
        <table class="table table-hover align-middle text-center">
            <thead class="thead-light">
                <tr>
                    <th scope="col" style="width: 7%;">From</th>
                    <th scope="col" style="width: 10%;">Subject</th>
                    <th scope="col" style="width: 10%;">Message</th>
                    <th scope="col" style="width: 10%;">Time</th>
                    <th scope="col" style="width: 5%;"></th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let email of emails">
                    <td>{{ email.from || '-' }}</td>
                    <td>{{ email.subject || '-' }}</td>
                    <td>{{ email.snippet || '-' }}</td>
                    <td>{{ email.time || '-' }}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-icon btn-primary" title="Open" (click)="openEmail(email)">
                                <i class="fa-solid fa-envelope-open-text"></i>
                            </button>
                            <button class="btn btn-icon btn-danger" title="Delete">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Email Modal -->
<div class="modal" tabindex="-1" role="dialog" [ngClass]="{'d-block': selectedEmail}"
    style="background: rgba(0,0,0,0.5);" *ngIf="selectedEmail">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-2" style="border-bottom: 2px solid #dee2e6;">
                <h5 class="modal-title">Reply to email</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                    (click)="closeModal()">
                </button>
            </div>
            <div class="modal-body text-start">
                <p><strong>Subject:</strong> {{ selectedEmail.subject }}</p>
                <p><strong>From:</strong> {{ selectedEmail.from }}</p>
                <p><strong>Time:</strong> {{ selectedEmail.time }}</p>
                <p><strong>Message:</strong></p>
                <p>{{ selectedEmail.snippet }}</p>

                <hr>

                <button class="btn btn-sm btn-outline-primary" (click)="showReplyForm = !showReplyForm">
                    <i class="fa-solid fa-reply"></i> Reply
                </button>

                <div *ngIf="showReplyForm" class="mt-3">
                    <textarea class="form-control" rows="5" [(ngModel)]="replyBody"
                        placeholder="Type your reply here..."></textarea>
                    <button class="btn btn-primary mt-2" (click)="sendReply()">Send Reply</button>
                </div>

            </div>
        </div>
    </div>
</div>