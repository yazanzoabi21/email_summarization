<div class="email-container">
    <div *ngIf="isLoading" class="alert alert-info text-center mt-3 mx-3">
        Loading emails...
    </div>

    <div *ngIf="emails.length === 0 && !isLoading" class="empty-state">
        <i class="fa-regular fa-envelope empty-icon"></i>
        <p class="empty-text">No emails found !</p>
    </div>

    <div class="table-responsive" *ngIf="!isLoading && emails.length > 0">
        <ng-container *ngIf="!selectedEmail; else detailView">
            <table class="table table-hover email-table align-middle text-center">
                <thead class="thead-light">
                    <tr>
                        <th style="width: 5%"></th>
                        <th style="width: 5%"></th>
                        <th style="width: 10%">Subject</th>
                        <th style="width: 10%">Recipient</th>
                        <th style="width: 10%">Message</th>
                        <th style="width: 10%">Time</th>
                        <th style="width: 10%">Status</th>
                        <th style="width: 5%"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let email of emails" [ngClass]="{ read: email.isRead, unread: !email.isRead }"
                        (click)="onEmailClick(email)" style="cursor: pointer">
                        <td>
                            <div class="checkbox-wrapper">
                                <input type="checkbox" class="form-check-input"
                                    (click)="toggleEmailSelection(email, $event)"
                                    [checked]="selectedEmails.includes(email)" />
                            </div>
                        </td>
                        <td>
                            <div class="star-wrapper">
                                <button class="btn btn-icon btn-star-status" title="Toggle Star"
                                    (click)="toggleStar(email, $event)">
                                    <i class="fa-star" [class.fa-solid]="email.isStarred"
                                        [class.fa-regular]="!email.isStarred" [class.text-warning]="email.isStarred"
                                        [class.text-secondary]="!email.isStarred">
                                    </i>
                                </button>
                            </div>
                        </td>
                        <td>
                            {{
                            email.subject
                            ? email.subject.length > 10
                            ? (email.subject | slice : 0 : 10) + "..."
                            : email.subject
                            : "-"
                            }}
                        </td>
                        <td>{{ email.recipient }}</td>
                        <td class="email-content">
                            {{
                            email.preview
                            ? email.preview.length > 25
                            ? (email.preview | slice : 0 : 25) + "..."
                            : email.preview
                            : "-"
                            }}
                        </td>
                        <td class="email-time">{{ email.time }}</td>
                        <td>
                            <span class="status-badge" [ngClass]="{
                    'status-sent': email.status === 'sent',
                    'status-pending': email.status === 'pending',
                    'status-unsent': email.status === 'unsent'
                  }">
                                {{ email.status }}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-read-status" title="Read Email"
                                    (click)="toggleReadStatus(email, $event)">
                                    <i class="fa-solid" [class.fa-envelope-open]="email.isRead"
                                        [class.fa-envelope]="!email.isRead"
                                        [ngClass]="email.isRead ? 'text-success' : 'text-secondary'"></i>
                                </button>

                                <button class="btn btn-icon btn-danger" title="Delete Email"
                                    (click)="deleteEmail(email); $event.stopPropagation()">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </ng-container>

        <ng-template #detailView>
            <div class="email-detail-card p-4">
                <div class="d-flex align-items-center mb-3">
                    <button class="btn btn-outline-success btn-sm" (click)="goBackToTable()">
                        <i class="fa fa-arrow-left me-2"></i> Back
                    </button>
                </div>

                <div class="d-flex justify-content-center">
                    <div class="email-content">
                        <div class="mb-3">
                            <h4 class="fw-bold">{{ selectedEmail?.subject || 'No Subject' }}</h4>
                            <p><strong>To:</strong> {{ selectedEmail?.recipient }}</p>
                            <p>
                                <strong>Status:</strong>
                                <span class="status-badge ms-2" [ngClass]="{
                                    'status-sent': selectedEmail?.status === 'sent',
                                    'status-pending': selectedEmail?.status === 'pending',
                                    'status-unsent': selectedEmail?.status === 'unsent'
                                  }">
                                    {{ selectedEmail?.status }}
                                </span>
                            </p>
                            <p><strong>Time:</strong> {{ selectedEmail?.time }}</p>
                        </div>

                        <div>
                            <p><strong>Message:</strong></p>
                            <p>{{ selectedEmail?.preview || 'No content available.' }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>
    </div>
</div>